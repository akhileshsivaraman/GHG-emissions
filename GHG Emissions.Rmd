---
title: "GHG Emissions"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Questions

* How are UK emissions changing?
  * Overall
  * Industries and sectors contributing the most to emissions
  * Industries and sectors reducing emissions the quickest and the slowest
* What are the implications of this for the UK government?

```{r message=FALSE}
# libraries
library(tidyverse)

# functions
source("pct_change.R")

# load data
ghg_section_totals <- read_csv("annual_emissions_section_totals.csv")
ghg_sector_totals <- read_csv("annual_emissions_breakdown.csv")
```

## How are UK emissions changing?
### Overall

* GHG emissions are trending downwards with a 40.4% reduction in the mass of air emission per annum in thousand tonnes of C02 equivalent
* GHG emissions in 2021 are 340'158 thousand tonnes of CO2e lower than in 1990
```{r}
#---- total annual emissions ----
# prepare data
annual_emissions <- ghg_section_totals[22,]
annual_emissions <- annual_emissions |>
  pivot_longer(cols = c("1990":"2021"),
               names_to = "Year",
               values_to = "Emissions") |>
  select(!`Section letter`)


# percentage change
total_GHG_1990 <- annual_emissions |>
  filter(Year == "1990") |>
  pull(Emissions)

total_GHG_2021 <- annual_emissions |>
  filter(Year == "2021") |>
  pull(Emissions)

total_GHG_pct_change <- ((total_GHG_2021 - total_GHG_1990) / total_GHG_1990) * 100

# absolute change
total_GHG_2021 - total_GHG_1990

# summary plot
ggplot(annual_emissions) +
  geom_point(aes(Year, Emissions)) +
  theme_classic() # custom theme later
```


### Industries
```{r}
# prepare data
annual_section_emissions <- ghg_section_totals[-c(22),] |>
  pivot_longer(cols = c("1990":"2021"),
               names_to = "Year",
               values_to = "Emissions")

# summary plot
ggplot(annual_section_emissions) +
  geom_point(aes(Year, Emissions)) +
  facet_wrap(~ `Section name`) +
  theme_classic()
```

Industries contributing the most to emissions:

* Eight have contributed heavily to total emissions over the 31-year period
* All 8 were amongst the top 8 highest emitters in 2021
* In 1990, Public Administration was in the top 8 and has since been displaced by Wholesale and Retail
```{r}
# total emissions over period
ghg_section_total_period <- ghg_section_totals |>
  rowwise(`Section name`) |>
  summarise(total_emissions = sum(c_across("1990":"2021")),
            `Section letter` = `Section letter`) |>
  arrange(desc(total_emissions)) |>
  rename("Total emissions" = total_emissions) |>
  mutate(`Section letter` = case_when(`Section name` == "Consumer expenditure" ~ "CE",
                                      TRUE ~ `Section letter`))

ggplot(ghg_section_total_period |>
         filter(`Section name` != "Total greenhouse gas emissions")) +
  geom_col(aes(`Section letter`, `Total emissions`)) +
  theme_classic()


# top emitters in 2021
absolute_top_emitting_section_2021 <- ghg_section_totals |>
  filter(`Section name` != "Total greenhouse gas emissions") |>
  slice_max(order_by = `2021`, n = 8) |>
  select(c("Section letter", "Section name", "2021"))

# top emitters in 1990
absolute_top_emitting_section_1990 <- ghg_section_totals |>
  filter(`Section name` != "Total greenhouse gas emissions") |>
  slice_max(order_by = `1990`, n = 8) |>
  select(c("Section letter", "Section name", "1990"))

setdiff(absolute_top_emitting_section_2021$`Section name`, absolute_top_emitting_section_1990$`Section name`)
setdiff(absolute_top_emitting_section_1990$`Section name`, absolute_top_emitting_section_2021$`Section name`)
```


Industries reducing emissions the quickest and the slowest:

* Although emissions have fallen overall, there has not been a reduction in emissions across the board. Construction, Real Estate, Wholesale & Retail Trade, Administrative Activities and Accommodation & Food Services have seen increases
* Comparatively, amongst the top 8 emitters, Agriculture, Forestry & Fishing, Consumer Expenditure and Transport & Storage have seen smaller reductions (<15%)
* The biggest percentage decrease in emissions has come from Mining & Quarrying with the biggest percentage increase coming from Real Estate
* While Real Estate has seen the biggest percentage increase, Construction has seen the biggest absolute increase
* The largest absolute decrease in emissions has been in Electricity Supply
```{r}
# percentage changes
ghg_section_pct_changes <- ghg_section_totals |>
  rowwise(`Section name`) |>
  summarise(pct_change = ((`2021` - `1990`)/`1990`)*100) |>
  arrange(desc(pct_change))

# absolute changes
ghg_section_absolute_changes <- ghg_section_totals |>
  rowwise(`Section name`) |>
  summarise(absolute_change = `2021` - `1990`) |>
  arrange(desc(absolute_change))
```



### Sectors
Sectors contributing the most to emissions:

* Since 1991, 7 sectors have produced more than 1 million thousand tonnes of CO2e
* These 7 sectors were also the top emitters in 2021
* 5 feature in the top 7 emitters of 1990 with Manufacture of petrochemicals and Mining of coal and lignite rounding out the list in place of Electricity production - gas and Air transport services
```{r}
# total emissions over period
ghg_sector_total_period <- ghg_sector_totals |>
  rowwise(Sector) |>
  summarise(total_emissions = sum(c_across("1990":"2021"))) |>
  arrange(desc(total_emissions))

# top 7 emitters in 2021
top_emitting_sectors_2021 <- ghg_sector_totals |>
  slice_max(order_by = `2021`, n = 7)

# top 7 emitters in 1990
top_emitting_sectors_1990 <- ghg_sector_totals |>
  slice_max(order_by = `1990`, n = 7)

setdiff(top_emitting_sectors_2021$Sector, top_emitting_sectors_1990$Sector)
setdiff(top_emitting_sectors_1990$Sector, top_emitting_sectors_2021$Sector)
```



### Emissions By Sector
A breakdown of emissions across the sectors of the 3 most polluting industries.

#### Electricity, gas, steam and air conditioning supply

* emissions from each sector has changed by:
```{r}
# summary plot: emissions by sector d
d_emissions <- ghg_section_breakdown |>
  filter(`Section letter` == "D") |>
  select("Sector":"2021") |>
  pivot_longer(cols = c("1990":"2021"),
               names_to = "Year",
               values_to = "Emissions")

ggplot(d_emissions) +
  geom_point(aes(Year, Emissions)) +
  theme_classic() +
  facet_wrap(~Sector)
```

```{r}
# percentage change calculations
d_sectors <- unique(d_emissions$Sector)

d_sectors_change <- map(d_sectors, pct_change, d_emissions)
d_sectors_change <- list_simplify(d_sectors_change)

d_sectors_change_table <- cbind(d_sectors, d_sectors_change) |>
  as_tibble() |>
  `colnames<-`(c("Sector", "Percentage change")) |>
  mutate(across(c(`Percentage change`), as.numeric)) |>
  mutate(across(c(`Percentage change`), round, 2))
```


#### Consumer Expenditure
```{r}
# summary plot: emissions by consumer expenditure
consumer_expenditure_emissions <- ghg_section_breakdown |>
  filter(grepl("Consumer expenditure", Sector)) |>
  select("Sector":"2021") |>
  pivot_longer(cols = c("1990":"2021"),
               names_to = "Year",
               values_to = "Emissions")

ggplot(consumer_expenditure_emissions) +
  geom_point(aes(Year, Emissions)) +
  theme_classic() +
  facet_wrap(~Sector)
```

```{r}
# percentage change calculations
consumer_expenditure_sectors <- unique(consumer_expenditure_emissions$Sector)

consumer_expenditure_change <- map(consumer_expenditure_sectors, pct_change, consumer_expenditure_emissions)
consumer_expenditure_change <- list_simplify(consumer_expenditure_change)

consumer_expenditure_change_table <- cbind(consumer_expenditure_sectors, consumer_expenditure_change) |>
  as_tibble() |>
  `colnames<-`(c("Sector", "Percentage change")) |>
  mutate(across(c(`Percentage change`), as.numeric)) |>
  mutate(across(c(`Percentage change`), round, 2))
```


#### Manufacturing
```{r}
# summary plot: emissions by sector c
c_emissions <- ghg_section_breakdown |>
  filter(`Section letter` == "C") |>
  select("Sector":"2021") |>
  pivot_longer(cols = c("1990":"2021"),
               names_to = "Year",
               values_to = "Emissions")

ggplot(c_emissions) +
  geom_point(aes(Year, Emissions)) +
  theme_classic() +
  facet_wrap(~Sector)
```

```{r}
# percentage change calculations
c_sectors <- unique(c_emissions$Sector)

c_sectors_change <- map(c_sectors, pct_change, c_emissions)
c_sectors_change <- list_simplify(c_sectors_change)

c_sectors_change_table <- cbind(c_sectors, c_sectors_change) |>
  as_tibble() |>
  `colnames<-`(c("Sector", "Percentage change")) |>
  mutate(across(c(`Percentage change`), as.numeric)) |>
  mutate(across(c(`Percentage change`), round, 2))
```

